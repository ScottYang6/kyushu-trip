<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°N ä¹å· Jarvis æ—…éŠåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src='https://unpkg.com/tesseract.js@4/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .iphone-x { width: 100%; height: 100vh; background: white; overflow: hidden; }
        .iphone-x .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; z-index: 50; }
        .scroll-hide::-webkit-scrollbar { display: none; }
        .tab-active { color: #3b82f6 !important; }
        .page { display: none; }
        .page-active { display: block; }
        
        /* æ™¯é»å¡ç‰‡å±•é–‹æ¨£å¼ */
        .spot-card { transition: all 0.3s ease; }
        .spot-card.active { border-color: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); }
        .spot-card.active .fa-chevron-down { transform: rotate(180deg); }
        .spot-detail { transition: all 0.3s ease; }
        .spot-detail:not(.hidden) { animation: slideDown 0.3s ease; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .mapcode-display {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 6px;
        }
        
        /* ç·¨è¼¯æ¨¡å¼æ¨£å¼æ§åˆ¶ */
        .edit-mode .delete-btn { display: flex !important; }
        .edit-mode .nav-map-btn { display: none !important; }
        .edit-mode .add-spot-btn { display: block !important; }
        .delete-btn { display: none; }
        
        /* æ–°å¢æ™¯é» Modal */
        .spot-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px; }
        .spot-modal.active { display: flex; }
        /* é•·æŒ‰æ‹–å‹•æç¤º */
        .spot-card::after {
            content: 'é•·æŒ‰æ‹–å‹•';
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #94a3b8;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .edit-mode .spot-card::after {
            opacity: 1;
        }
        .spot-card {
            position: relative;
            cursor: grab;
        }
        .spot-card:active {
            cursor: grabbing;
        }
        .sortable-ghost {
            opacity: 0.4;
            background: #e0f2fe;
        }
        .sortable-drag {
            background: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transform: scale(1.02);
        }
        
        /* åº•éƒ¨æ»‘å…¥å‹•ç•« */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="iphone-x flex flex-col">
        <!-- Status Bar -->
        <div class="h-12 flex justify-between items-center px-6 text-xs font-bold bg-white z-20 pt-2">
            <span>9:41</span>
            <div class="flex gap-1">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

        <!-- Main Scroll Area -->
        <div class="flex-1 overflow-y-auto scroll-hide" id="mainScroll">
            
            <!-- Page 1: Dashboard -->
            <div id="home" class="page page-active px-6 pt-4 pb-24">
                <div class="mb-6">
                    <h1 class="text-2xl font-bold text-slate-800 text-center">ä¹å·ä¹‹æ—… ğŸ‡¯ğŸ‡µ</h1>
                    <p class="text-center text-slate-500 text-sm">2025/07/27 - 08/01</p>
                </div>
                
                <!-- Weather -->
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl p-5 text-white shadow-lg mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-lg opacity-80">ç¦å²¡, æ—¥æœ¬</p>
                            <p class="text-4xl font-bold">29Â°C</p>
                            <p class="text-xs mt-2">â˜ï¸ å¤šé›²æ™‚æ™´ï¼Œé©åˆå‡ºéŠ</p>
                        </div>
                        <i class="fas fa-cloud-sun text-5xl text-blue-200"></i>
                    </div>
                </div>

                <div class="mb-6 text-slate-800">
                    <h2 class="text-lg font-bold mb-4">å³å°‡å‰å¾€</h2>
                    <div class="bg-white border border-slate-100 rounded-2xl p-4 shadow-sm flex gap-4 relative">
                        <div class="w-16 h-16 bg-slate-200 rounded-xl overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1590559899731-a382839e5549?q=80&w=200&auto=format&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-slate-800">ç¦å²¡åœ‹éš›æ©Ÿå ´</p>
                            <p class="text-[10px] text-slate-400 mt-0.5">Day 1 èµ·é»</p>
                            <div class="mt-2 flex items-center gap-2">
                                <span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full font-bold">7/27 å‡ºç™¼</span>
                            </div>
                        </div>
                        <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡æ©Ÿå ´'), '_blank')" class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white shadow-md">
                            <i class="fas fa-map-location-dot"></i>
                        </button>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 class="text-lg font-bold mb-4 text-slate-800">å¾ŒçºŒè¡Œç¨‹</h2>
                    <div id="upcomingSchedule" class="bg-slate-50 rounded-3xl p-5 space-y-4 relative overflow-hidden">
                        <!-- å‹•æ…‹å…§å®¹å°‡ç”± JavaScript ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- Page 2: Itinerary -->
            <div id="itinerary" class="page px-6 pt-4 pb-24">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">è©³ç´°è¡Œç¨‹</h2>
                    <button id="editModeBtn" onclick="toggleEditMode()" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-full text-sm font-bold">ç·¨è¼¯</button>
                </div>
                
                <!-- æ–°å¢æ™¯é»æŒ‰éˆ•ï¼ˆç·¨è¼¯æ¨¡å¼é¡¯ç¤ºï¼‰-->
                <div id="addSpotSection" class="hidden mb-4">
                    <button onclick="openAddSpotModal()" class="w-full bg-green-500 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 mb-3">
                        <i class="fas fa-plus-circle"></i> æ–°å¢æ™¯é»
                    </button>
                </div>
                
                <div id="itineraryList" class="space-y-6">
                    
                    <!-- Day 1 -->
                    <div class="mb-6">
                        <p class="font-bold text-blue-600 mb-3">Day 1 - 7/27 (ä¸€) ç¦å²¡å¸‚å€</p>
                        
                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden" data-spot-id="day1-1">
                            <div class="p-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1 cursor-pointer" onclick="toggleSpot(this.closest('.spot-card').querySelector('.spot-header'))">
                                        <p class="font-bold text-slate-800 text-lg">ç¦å²¡åœ‹éš›æ©Ÿå ´</p>
                                        <div class="mapcode-display">13 294 821*15</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button onclick="event.stopPropagation(); window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡æ©Ÿå ´ ç¦å²¡å¸‚åšå¤šå€'), '_blank')" class="nav-map-btn w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center">
                                            <i class="fas fa-map-location-dot"></i>
                                        </button>
                                        <button onclick="event.stopPropagation(); deleteSpot(this.closest('.spot-card'))" class="delete-btn hidden text-red-500 w-8 h-8 rounded-full bg-red-50 flex items-center justify-center">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <i class="fas fa-chevron-down text-slate-400 transition-transform cursor-pointer" onclick="toggleSpot(this.closest('.spot-card').querySelector('.spot-header'))"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>09:00 æŠµé” â†’ æ­æ¥é§å·´å£«åˆ°åœ‹å…§ç·š</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚åšå¤šå€</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-info-circle text-green-500 mr-2"></i>åœ‹éš›ç·šèˆªå»ˆ â†’ å…è²»æ¥é§å·´å£«5è™Ÿç«™ç‰Œ â†’ åœ‹å…§ç·šèˆªå»ˆ â†’ åœ°éµ</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡æ©Ÿå ´ ç¦å²¡å¸‚åšå¤šå€'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1 cursor-pointer" onclick="toggleSpot(this.closest('.spot-card'))">
                                        <p class="font-bold text-slate-800 text-lg">ä¸­æ´²å·ç«¯ç«™ è¡Œæå¯„å­˜</p>
                                        <div class="mapcode-display">13 323 126*44</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button onclick="event.stopPropagation(); window.open('https://www.google.com/maps/search/' + encodeURIComponent('ä¸­æ´²å·ç«¯ç«™ ç¦å²¡å¸‚åšå¤šå€ä¸­æ´²'), '_blank')" class="nav-map-btn w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center">
                                            <i class="fas fa-map-location-dot"></i>
                                        </button>
                                        <button onclick="event.stopPropagation(); deleteSpot(this.closest('.spot-card'))" class="delete-btn hidden text-red-500 w-8 h-8 rounded-full bg-red-50 flex items-center justify-center">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <i class="fas fa-chevron-down text-slate-400 transition-transform cursor-pointer" onclick="toggleSpot(this.closest('.spot-card'))"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>åœ°éµå¯„æ”¾ï¼šé¦–ç­è»Šï½æœ«ç­è»Š</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-store text-green-500 mr-2"></i>Baggage Stationï¼š09:30-21:00ï¼ˆå‘¨æ—¥ä¼‘ï¼‰</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>åšå¤šå€ä¸­æ´²5-1-22</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ä¸­æ´²å·ç«¯ç«™ ç¦å²¡å¸‚åšå¤šå€ä¸­æ´²'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1 cursor-pointer" onclick="toggleSpot(this.closest('.spot-card'))">
                                        <p class="font-bold text-slate-800 text-lg">ä¸€è˜­æ‹‰éºµ ç¸½æœ¬åº—</p>
                                        <div class="mapcode-display">13 318 631*71</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button onclick="event.stopPropagation(); window.open('https://www.google.com/maps/search/' + encodeURIComponent('ä¸€è˜­æ‹‰éºµ ç¸½æœ¬åº— ç¦å²¡å¸‚åšå¤šå€ä¸­æ´²5-3-2'), '_blank')" class="nav-map-btn w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center">
                                            <i class="fas fa-map-location-dot"></i>
                                        </button>
                                        <button onclick="event.stopPropagation(); deleteSpot(this.closest('.spot-card'))" class="delete-btn hidden text-red-500 w-8 h-8 rounded-full bg-red-50 flex items-center justify-center">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <i class="fas fa-chevron-down text-slate-400 transition-transform cursor-pointer" onclick="toggleSpot(this.closest('.spot-card'))"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>24å°æ™‚ç‡Ÿæ¥­</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚åšå¤šå€ä¸­æ´²5-3-2</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-star text-yellow-500 mr-2"></i>å…¨çƒå”¯ä¸€ç¸½æœ¬åº—ï¼Œé™å®šäº”è§’ç¢—</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ä¸€è˜­æ‹‰éºµ ç¸½æœ¬åº— ç¦å²¡å¸‚åšå¤šå€ä¸­æ´²5-3-2'), '_blank')" class="w-full bg-red-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-blue-50 border border-blue-100 rounded-2xl shadow-sm overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ğŸ¨ ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—</p>
                                        <div class="mapcode-display mt-2">13 318 605*31</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-blue-200 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-hotel text-blue-500 mr-2"></i>Solaria Nishitetsu Hotelï¼ˆä¸å«æ—©é¤ï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚ä¸­å¤®å€å¤©ç¥2-11-3</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-subway text-purple-500 mr-2"></i>å¤©ç¥ç«™ç›´çµï¼Œäº¤é€šè¶…ä¾¿åˆ©</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-info-circle text-green-500 mr-2"></i>ä½4æ™š (Day 1, 3, 4, 5)</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº— ç¦å²¡å¸‚ä¸­å¤®å€å¤©ç¥2-11-3'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Day 2 -->
                    <div class="mb-6">
                        <p class="font-bold text-blue-600 mb-3">Day 2 - 7/28 (äºŒ) å¤ªå®°åºœ â†’ ç”±å¸ƒé™¢</p>
                        
                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">å¤ªå®°åºœå¤©æ»¿å®®</p>
                                        <div class="mapcode-display">55 364 073*51</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>06:30-18:30</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡ç¸£å¤ªå®°åºœå¸‚å®°åºœ4-7-1</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-torii-gate text-purple-500 mr-2"></i>å­¸å•ä¹‹ç¥ï¼Œè¡¨åƒé“é€›è¡—</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('å¤ªå®°åºœå¤©æ»¿å®® ç¦å²¡ç¸£å¤ªå®°åºœå¸‚å®°åºœ4-7-1'), '_blank')" class="w-full bg-purple-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">Yufuin Rakuyu æ¹¯å¸ƒé™¢ æ¨‚æ¶Œ</p>
                                        <div class="mapcode-display">269 359 581*14</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-hotel text-green-500 mr-2"></i>å«æ—©é¤æ™šé¤ï¼Œæº«æ³‰æ—…é¤¨</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>å¤§åˆ†ç¸£ç”±å¸ƒå¸‚æ¹¯å¸ƒé™¢ç”ºå·ä¸Š269</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-hot-tub text-blue-400 mr-2"></i>ä¸€æ³ŠäºŒé£Ÿï¼Œæº«æ³‰é«”é©—</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('æ¹¯å¸ƒé™¢æ¨‚æ¶Œ å¤§åˆ†ç¸£ç”±å¸ƒå¸‚æ¹¯å¸ƒé™¢ç”ºå·ä¸Š269'), '_blank')" class="w-full bg-green-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Day 3 -->
                    <div class="mb-6">
                        <p class="font-bold text-blue-600 mb-3">Day 3 - 7/29 (ä¸‰) é‡ç”Ÿå‹•ç‰©åœ’ â†’ åšå¤š</p>
                        
                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ä¹å·éæ´²é‡ç”Ÿå‹•ç‰©åœ’</p>
                                        <div class="mapcode-display">13 594 009*72</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>09:30-16:30ï¼ˆæœ€å¾Œå…¥åœ’16:00ï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-ticket-alt text-green-500 mr-2"></i>æˆäºº Â¥2,600 / å…’ç«¥ Â¥1,500</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡ç¸£æ±å³°æ‘å¤§å­—å®ç å±±1087</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-paw text-orange-500 mr-2"></i>å¯é¤µé£Ÿç…å­ã€å¤§è±¡ï¼Œè‡ªé§•éŠåœ’</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’ ã‚¢ãƒ•ãƒªã‚«ãƒ³ã‚µãƒ•ã‚¡ãƒª'), '_blank')" class="w-full bg-orange-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">æ—¥ç”°å¸‚</p>
                                        <div class="mapcode-display">13 569 233*24</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>è‡ªç”±æ•£ç­–</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡ç¸£æ—¥ç”°å¸‚</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-archway text-purple-500 mr-2"></i>è±†ç”°ç”ºè€è¡—ã€ä¸‰éšˆå·ã€é†¬æ²¹è€åº—</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('æ—¥ç”°å¸‚ è±†ç”°ç”º'), '_blank')" class="w-full bg-purple-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">Canal City Hakata åšå¤šé‹æ²³åŸ</p>
                                        <div class="mapcode-display">13 319 347*77</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>10:00-21:00ï¼ˆåº—é‹ªï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-film text-pink-500 mr-2"></i>é‹¼å½ˆè¡¨æ¼”ï¼š19:00 / 21:00</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚åšå¤šå€ä½å‰1-2</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-shopping-bag text-blue-500 mr-2"></i>è³¼ç‰©ã€ç¾é£Ÿã€å™´æ°´ç§€</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('Canal City Hakata'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-blue-50 border border-blue-100 rounded-2xl shadow-sm overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ğŸ¨ ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—</p>
                                        <div class="mapcode-display mt-2">13 318 605*31</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-blue-200 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-hotel text-blue-500 mr-2"></i>ç¬¬äºŒæ™šä½å®¿ï¼ˆå›åšå¤šï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚ä¸­å¤®å€å¤©ç¥2-11-3</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-subway text-purple-500 mr-2"></i>å¤©ç¥ç«™ç›´çµ</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Day 4 -->
                    <div class="mb-6">
                        <p class="font-bold text-blue-600 mb-3">Day 4 - 7/30 (å››) é–€å¸æ¸¯ â†’ å°å€‰</p>
                        
                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">é–€å¸æ¸¯å¾©å¤å€</p>
                                        <div class="mapcode-display">13 471 222*72</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>è—ç¿¼æ©‹é–‹æ©‹ï¼šæ¯å°æ™‚10:00-16:00</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡ç¸£åŒ—ä¹å·å¸‚é–€å¸å€</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-camera text-purple-500 mr-2"></i>æ‡·èˆŠå»ºç¯‰ã€æµ·å³½å»£å ´ã€æ™®æ¨‚ç¾é›…é£¯åº—</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('é–€å¸æ¸¯ãƒ¬ãƒˆãƒ­'), '_blank')" class="w-full bg-purple-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ä¹å·éµé“æ­·å²é¤¨</p>
                                        <div class="mapcode-display">13 471 222*88</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>09:00-17:00ï¼ˆé€±ä¸€ä¼‘ï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-ticket-alt text-green-500 mr-2"></i>é–€ç¥¨ Â¥300</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>åŒ—ä¹å·å¸‚é–€å¸å€æ¸¯ç”º2-1</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-train text-blue-500 mr-2"></i>è’¸æ°£ç«è»Šå±•ç¤ºã€æ¨¡æ“¬é§•é§›</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ä¹å·é‰„é“è¨˜å¿µé¤¨'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">The Outlets Kitakyushu</p>
                                        <div class="mapcode-display">13 464 334*16</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>10:00-21:00</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>åŒ—ä¹å·å¸‚å…«å¹¡æ±åŒºæ±ç”°4-1-1</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-shopping-bag text-pink-500 mr-2"></i>å“ç‰ŒæŠ˜æ‰£åº—ã€è³¼ç‰©ä¸­å¿ƒ</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('The Outlets Kitakyushu'), '_blank')" class="w-full bg-pink-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-blue-50 border border-blue-100 rounded-2xl shadow-sm overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ğŸ¨ ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—</p>
                                        <div class="mapcode-display mt-2">13 318 605*31</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-blue-200 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-hotel text-blue-500 mr-2"></i>ç¬¬ä¸‰æ™šä½å®¿</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚ä¸­å¤®å€å¤©ç¥2-11-3</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Day 5 -->
                    <div class="mb-6">
                        <p class="font-bold text-blue-600 mb-3">Day 5 - 7/31 (äº”) æµ·ä¹‹ä¸­é“</p>
                        
                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">æµ·æ´‹ä¸–ç•Œæµ·ä¹‹ä¸­é“</p>
                                        <div class="mapcode-display">13 305 351*24</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>09:00-17:30ï¼ˆé€±æœ«å»¶é•·ï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-ticket-alt text-green-500 mr-2"></i>é–€ç¥¨è«‹æŸ¥å®˜ç¶²</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚æ±åŒºæµ·ã®ä¸­é“18-28</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-fish text-blue-500 mr-2"></i>æµ·è±šç§€ã€æµ·è±¹ç§€ã€è§¸æ‘¸æ± </p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ãƒãƒªãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰æµ·ã®ä¸­é“'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">æµ·ä¹‹ä¸­é“æµ·æ¿±å…¬åœ’</p>
                                        <div class="mapcode-display">13 305 352*77</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>09:30-17:30</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-ticket-alt text-green-500 mr-2"></i>å…¥åœ’ Â¥450 / é›»å‹•è»Š Â¥1,000/3hr</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚æ±åŒºè¥¿æˆ¸å´18-25</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-bicycle text-green-500 mr-2"></i>æ²™ç˜ã€èŠ±æµ·ã€å–®è»ŠéŠåœ’</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('æµ·ã®ä¸­é“æµ·æµœå…¬åœ’'), '_blank')" class="w-full bg-green-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-blue-50 border border-blue-100 rounded-2xl shadow-sm overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ğŸ¨ ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—</p>
                                        <div class="mapcode-display mt-2">13 318 605*31</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-blue-200 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-hotel text-blue-500 mr-2"></i>ç¬¬å››æ™šä½å®¿ï¼ˆæœ€å¾Œä¸€æ™šï¼‰</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚ä¸­å¤®å€å¤©ç¥2-11-3</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Day 6 -->
                    <div class="mb-6">
                        <p class="font-bold text-blue-600 mb-3">Day 6 - 8/01 (å…­) è¿”ç¨‹</p>
                        
                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">æœ€å¾Œæ¡è³¼</p>
                                        <div class="mapcode-display">13 318 605*65</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-clock text-blue-500 mr-2"></i>ä¾ç­æ©Ÿæ™‚é–“å®‰æ’</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>å¤©ç¥å•†åœˆã€åœ°ä¸‹è¡—</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-shopping-bag text-purple-500 mr-2"></i>ä¼´æ‰‹ç¦®ã€æœ€å¾Œè£œè²¨</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('å¤©ç¥åœ°ä¸‹è¡—'), '_blank')" class="w-full bg-purple-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>

                        <div class="spot-card bg-white border border-slate-100 rounded-2xl shadow-sm overflow-hidden">
                            <div class="p-4 cursor-pointer" onclick="toggleSpot(this)">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-bold text-slate-800 text-lg">ç¦å²¡åœ‹éš›æ©Ÿå ´</p>
                                        <div class="mapcode-display">13 294 821*15</div>
                                    </div>
                                    <i class="fas fa-chevron-down text-slate-400 transition-transform mt-1"></i>
                                </div>
                            </div>
                            <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-plane text-blue-500 mr-2"></i>å›ç¨‹ç­æ©Ÿ</p>
                                <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡å¸‚åšå¤šå€</p>
                                <p class="text-sm text-slate-600 mb-3"><i class="fas fa-info-circle text-green-500 mr-2"></i>å»ºè­°æå‰2å°æ™‚æŠµé”</p>
                                <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('ç¦å²¡æ©Ÿå ´'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Page 3: Accounting -->
            <div id="accounting" class="page px-6 pt-4 pb-24">
                <h2 class="text-2xl font-bold mb-4 text-slate-800">è¨˜å¸³æœ¬</h2>
                
                <!-- ç¸½è¨ˆå¡ç‰‡ -->
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 text-white rounded-3xl p-6 mb-4 shadow-xl">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="opacity-60 text-sm">ç¸½èŠ±è²»</p>
                            <p class="text-3xl font-bold mt-1" id="totalAmount">Â¥ 0</p>
                        </div>
                        <div class="text-right">
                            <p class="opacity-60 text-xs">ç´„åˆå°å¹£</p>
                            <p class="text-xl font-bold text-blue-300" id="totalTWD">TWD 0</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-slate-700 grid grid-cols-3 gap-2 text-center text-xs">
                        <div>
                            <p class="opacity-60">ç­†æ•¸</p>
                            <p class="font-bold text-lg" id="expenseCount">0</p>
                        </div>
                        <div>
                            <p class="opacity-60">å¹³å‡</p>
                            <p class="font-bold text-lg" id="avgAmount">Â¥0</p>
                        </div>
                        <div>
                            <p class="opacity-60">ä»Šæ—¥</p>
                            <p class="font-bold text-lg text-green-400" id="todayAmount">Â¥0</p>
                        </div>
                    </div>
                </div>

                <!-- æƒææŒ‰éˆ• -->
                <button onclick="showReceiptOptions()" class="w-full bg-blue-500 text-white font-bold py-4 rounded-2xl flex items-center justify-center gap-3 shadow-lg active:scale-95 transition-transform mb-4">
                    <i class="fas fa-camera"></i> æƒææ”¶æ“š
                </button>
                <!-- éš±è—çš„æ–‡ä»¶è¼¸å…¥æ¡† -->
                <input type="file" id="receiptInput" accept="image/*" class="hidden" onchange="processReceipt(this)">
                <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden" onchange="processReceipt(this)">

                <!-- è¼‰å…¥ä¸­æç¤º -->
                <div id="scanningStatus" class="hidden bg-blue-50 border border-blue-100 rounded-2xl p-4 mb-4">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-spinner fa-spin text-blue-500"></i>
                        <div class="flex-1">
                            <p class="text-sm font-bold text-slate-700">æ­£åœ¨è¾¨è­˜æ”¶æ“š...</p>
                            <div class="w-full bg-slate-200 rounded-full h-1.5 mt-2">
                                <div id="scanProgress" class="bg-blue-500 h-1.5 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åŒ¯ç‡æ›ç®—å™¨ -->
                <div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
                    <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-exchange-alt text-green-500"></i> åŒ¯ç‡æ›ç®—
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center gap-2">
                            <div class="flex-1">
                                <label class="text-xs text-slate-500 mb-1 block">æ—¥åœ“ JPY</label>
                                <input id="jpyInput" type="number" placeholder="0" class="w-full border border-slate-200 rounded-xl px-3 py-2 text-sm" oninput="convertCurrency('jpy')">
                            </div>
                            <i class="fas fa-arrow-right text-slate-400 mt-5"></i>
                            <div class="flex-1">
                                <label class="text-xs text-slate-500 mb-1 block">å°å¹£ TWD</label>
                                <input id="twdInput" type="number" placeholder="0" class="w-full border border-slate-200 rounded-xl px-3 py-2 text-sm" oninput="convertCurrency('twd')">
                            </div>
                        </div>
                        <div class="flex items-center justify-between bg-slate-50 rounded-xl p-3">
                            <span class="text-xs text-slate-600">ç•¶å‰åŒ¯ç‡</span>
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-bold text-slate-800">1 JPY =</span>
                                <input id="exchangeRate" type="number" value="0.22" step="0.01" class="w-16 border border-slate-200 rounded-lg px-2 py-1 text-sm text-center" onchange="updateExchangeRate()">
                                <span class="text-sm font-bold text-slate-800">TWD</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é¡çµ±è¨ˆåœ–è¡¨ -->
                <div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
                    <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-chart-pie text-blue-500"></i> æ”¯å‡ºåˆ†é¡
                    </h3>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div class="bg-orange-50 rounded-xl p-3">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-utensils text-orange-500"></i>
                                <span class="text-xs text-slate-600">é¤é£²</span>
                            </div>
                            <p class="font-bold text-slate-800" id="cat-food">Â¥0</p>
                        </div>
                        <div class="bg-blue-50 rounded-xl p-3">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-train text-blue-500"></i>
                                <span class="text-xs text-slate-600">äº¤é€š</span>
                            </div>
                            <p class="font-bold text-slate-800" id="cat-transport">Â¥0</p>
                        </div>
                        <div class="bg-pink-50 rounded-xl p-3">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-shopping-bag text-pink-500"></i>
                                <span class="text-xs text-slate-600">è³¼ç‰©</span>
                            </div>
                            <p class="font-bold text-slate-800" id="cat-shopping">Â¥0</p>
                        </div>
                        <div class="bg-purple-50 rounded-xl p-3">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-bed text-purple-500"></i>
                                <span class="text-xs text-slate-600">ä½å®¿</span>
                            </div>
                            <p class="font-bold text-slate-800" id="cat-hotel">Â¥0</p>
                        </div>
                        <div class="bg-green-50 rounded-xl p-3">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-ticket-alt text-green-500"></i>
                                <span class="text-xs text-slate-600">æ™¯é»</span>
                            </div>
                            <p class="font-bold text-slate-800" id="cat-ticket">Â¥0</p>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-3">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-ellipsis-h text-gray-500"></i>
                                <span class="text-xs text-slate-600">å…¶ä»–</span>
                            </div>
                            <p class="font-bold text-slate-800" id="cat-other">Â¥0</p>
                        </div>
                    </div>
                </div>

                <!-- æ‰‹å‹•æ–°å¢æ”¯å‡º -->
                <div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
                    <h3 class="font-bold text-slate-800 mb-3">æ‰‹å‹•æ–°å¢</h3>
                    <div class="space-y-3">
                        <input id="manualStore" type="text" placeholder="å•†å®¶åç¨±" class="w-full border border-slate-200 rounded-xl px-3 py-2 text-sm">
                        <div class="flex gap-2">
                            <input id="manualAmount" type="number" placeholder="é‡‘é¡ Â¥" class="flex-1 border border-slate-200 rounded-xl px-3 py-2 text-sm">
                            <select id="manualCategory" class="border border-slate-200 rounded-xl px-3 py-2 text-sm bg-white">
                                <option value="food">ğŸœ é¤é£²</option>
                                <option value="transport">ğŸšƒ äº¤é€š</option>
                                <option value="shopping">ğŸ›ï¸ è³¼ç‰©</option>
                                <option value="hotel">ğŸ¨ ä½å®¿</option>
                                <option value="ticket">ğŸ« æ™¯é»</option>
                                <option value="other">ğŸ“¦ å…¶ä»–</option>
                            </select>
                        </div>
                        <button onclick="addManualExpense()" class="w-full bg-green-500 text-white font-bold py-2 rounded-xl text-sm">æ–°å¢æ”¯å‡º</button>
                    </div>
                </div>

                <!-- æ”¯å‡ºåˆ—è¡¨ -->
                <div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
                    <h3 class="font-bold text-slate-800 mb-3 flex items-center justify-between">
                        <span>æ”¯å‡ºæ˜ç´°</span>
                        <span class="text-xs text-slate-500" id="expenseCountBadge">0 ç­†</span>
                    </h3>
                    <div id="expenseList" class="space-y-2 max-h-60 overflow-y-auto">
                        <div class="text-center text-slate-400 py-8">
                            <i class="fas fa-receipt text-3xl mb-2"></i>
                            <p class="text-sm">å°šç„¡æ”¯å‡ºè¨˜éŒ„</p>
                        </div>
                    </div>
                </div>

                <!-- åŒ¯å‡ºåŠŸèƒ½ -->
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                    <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-download text-blue-500"></i> åŒ¯å‡ºè³‡æ–™
                    </h3>
                    <div class="space-y-2">
                        <button onclick="exportToExcel()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2">
                            <i class="fas fa-file-excel"></i> ä¸‹è¼‰ Excel æª”æ¡ˆ
                        </button>
                        <button onclick="exportToEmail()" class="w-full bg-slate-100 text-slate-700 font-bold py-3 rounded-xl flex items-center justify-center gap-2">
                            <i class="fas fa-envelope"></i> å¯„é€åˆ° Email
                        </button>
                    </div>
                </div>

                <!-- åŒ¯å‡ºé è¦½ Modal -->
                <div id="exportModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
                    <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
                        <h3 class="font-bold text-lg mb-4">åŒ¯å‡ºé è¦½</h3>
                        <div id="exportPreview" class="bg-slate-50 rounded-xl p-3 text-xs font-mono mb-4 max-h-40 overflow-y-auto"></div>
                        <div class="flex gap-2">
                            <button onclick="closeExportModal()" class="flex-1 bg-slate-100 py-2 rounded-xl font-bold">å–æ¶ˆ</button>
                            <button onclick="confirmExport()" class="flex-1 bg-blue-500 text-white py-2 rounded-xl font-bold">ç¢ºèªåŒ¯å‡º</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 4: Notes -->
            <div id="jarvis" class="page px-6 pt-4 pb-32">
                <h2 class="text-xl font-bold mb-3 text-slate-800">Google æœå°‹</h2>
                <form onsubmit="handleSearch(event)" class="relative mb-4">
                    <input id="searchInput" type="text" placeholder="æœå°‹æ™¯é»ã€ç¾é£Ÿã€äº¤é€š..." 
                        class="w-full bg-white border border-slate-200 rounded-2xl px-4 py-3 pl-12 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none shadow-sm">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-500 text-white px-4 py-1.5 rounded-xl text-xs font-bold">æœå°‹</button>
                </form>

                <h2 class="text-lg font-bold mb-3 text-slate-800 flex items-center gap-2">
                    <i class="fas fa-clipboard-list text-blue-500"></i> å‚™è¨»äº‹é …
                </h2>
                <div class="bg-white border border-slate-200 rounded-2xl p-3 mb-4 flex gap-2">
                    <input id="noteInput" type="text" placeholder="æ–°å¢å‚™è¨»..." 
                        class="flex-1 text-sm outline-none bg-transparent"
                        onkeypress="if(event.key==='Enter')addNote()">
                    <button onclick="addNote()" class="bg-blue-500 text-white px-4 py-2 rounded-xl text-xs font-bold">æ–°å¢</button>
                </div>
                <div id="notesList" class="space-y-2 mb-6"></div>

                <h2 class="text-lg font-bold mb-3 text-slate-800 flex items-center gap-2">
                    <i class="fas fa-suitcase text-green-500"></i> è¡Œææª¢æŸ¥æ¸…å–®
                </h2>
                <div class="bg-white rounded-2xl p-4 shadow-sm mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-bold text-slate-700">å®Œæˆåº¦</span>
                        <span id="packProgress" class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">0%</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2 mb-4">
                        <div id="progressBar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    
                    <!-- æ–‡ä»¶é¡ -->
                    <div class="mb-4">
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">ğŸ“„ æ–‡ä»¶</p>
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">è­·ç…§</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">JR Pass å…Œæ›åˆ¸</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">é£¯åº—é è¨‚ç¢ºèªå–®</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ©Ÿç¥¨é›»å­ç¥¨</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- é›»å­ç”¢å“ -->
                    <div class="mb-4">
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">ğŸ”Œ é›»å­ç”¢å“</p>
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ‰‹æ©Ÿå……é›»å™¨</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">è¡Œå‹•é›»æº</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">è¬åœ‹è½‰æ¥é ­</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">ç›¸æ©Ÿ/è¨˜æ†¶å¡</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- è¡£ç‰© -->
                    <div class="mb-4">
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">ğŸ‘• è¡£ç‰©</p>
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ›æ´—è¡£ç‰©ï¼ˆ5å¤©ä»½ï¼‰</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">å¤–å¥—/è–„é•·è¢–</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">èˆ’é©èµ°è·¯é‹</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ‹–é‹/å®¤å…§é‹</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- è—¥å“ -->
                    <div class="mb-4">
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">ğŸ’Š è—¥å“</p>
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ„Ÿå†’è—¥</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">è…¸èƒƒè—¥</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ­¢ç—›è—¥</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æšˆè»Šè—¥</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- å…¶ä»– -->
                    <div>
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">ğŸ’ å…¶ä»–</p>
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">é˜²æ›¬ä¹³</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">é›¨å…·ï¼ˆé›¨å‚˜/é›¨è¡£ï¼‰</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">æ°´å£º</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">é›¶éŒ¢åŒ…</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="check-item w-5 h-5 rounded border-slate-300 text-blue-500" onchange="updateProgress()">
                                <span class="text-sm text-slate-700">è³¼ç‰©è¢‹/ç’°ä¿è¢‹</span>
                            </label>
                        </div>
                    </div>
                </div>

                <h2 class="text-lg font-bold mb-3 text-slate-800 flex items-center gap-2">
                    <i class="fas fa-phone-alt text-red-500"></i> ç·Šæ€¥è¯çµ¡
                </h2>
                <div class="bg-red-50 border border-red-100 rounded-2xl p-4 mb-6">
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center gap-2">
                            <span class="bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">è­¦å¯Ÿ</span>
                            <span class="text-slate-700">110</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">æ•‘è­·è»Š</span>
                            <span class="text-slate-700">119</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs font-bold">å°ç£é§ç¦å²¡è¾¦äº‹è™•</span>
                            <span class="text-slate-700">+81-92-771-2122</span>
                        </div>
                    </div>
                </div>
                
                <div class="h-20"></div>
            </div>

        </div>

        <!-- Tab Bar -->
        <div class="tab-bar h-20 bg-white border-t border-slate-100 flex items-center justify-around px-4 pb-4">
            <button onclick="showPage('home', this)" class="nav-btn flex flex-col items-center gap-1 tab-active">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[10px] font-bold">ä¸»é </span>
            </button>
            <button onclick="showPage('itinerary', this)" class="nav-btn flex flex-col items-center gap-1 text-slate-400">
                <i class="fas fa-calendar-day text-xl"></i>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button onclick="showPage('accounting', this)" class="nav-btn flex flex-col items-center gap-1 text-slate-400">
                <i class="fas fa-wallet text-xl"></i>
                <span class="text-[10px] font-bold">è¨˜å¸³</span>
            </button>
            <button onclick="showPage('jarvis', this)" class="nav-btn flex flex-col items-center gap-1 text-slate-400">
                <i class="fas fa-clipboard-list text-xl"></i>
                <span class="text-[10px] font-bold">å‚™è¨»</span>
            </button>
        </div>

        <!-- Home Indicator -->
        <div class="h-1 bg-slate-200 rounded-full mx-auto w-32 mb-1"></div>
    </div>

    <script>
        let isEditMode = false;

        function showPage(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('page-active'));
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('tab-active');
                b.classList.add('text-slate-400');
            });
            
            document.getElementById(pageId).classList.add('page-active');
            btn.classList.add('tab-active');
            btn.classList.remove('text-slate-400');
            document.getElementById('mainScroll').scrollTop = 0;
        }

        // æ™¯é»å±•é–‹/æ”¶åˆåŠŸèƒ½
        function toggleSpot(element) {
            const card = element.closest('.spot-card');
            const detail = card.querySelector('.spot-detail');
            
            // é—œé–‰å…¶ä»–å·²å±•é–‹çš„å¡ç‰‡
            document.querySelectorAll('.spot-card.active').forEach(activeCard => {
                if (activeCard !== card) {
                    activeCard.classList.remove('active');
                    activeCard.querySelector('.spot-detail').classList.add('hidden');
                }
            });
            
            // åˆ‡æ›ç•¶å‰å¡ç‰‡
            card.classList.toggle('active');
            detail.classList.toggle('hidden');
        }

        // Google æœå°‹
        function handleSearch(e) {
            e.preventDefault();
            const query = document.getElementById('searchInput').value;
            if (query) {
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            }
        }

        // è¡Œæé€²åº¦
        function updateProgress() {
            const checkboxes = document.querySelectorAll('.check-item');
            const checked = document.querySelectorAll('.check-item:checked');
            const percentage = checkboxes.length > 0 ? Math.round((checked.length / checkboxes.length) * 100) : 0;
            
            document.getElementById('packProgress').textContent = percentage + '%';
            document.getElementById('progressBar').style.width = percentage + '%';
            
            // å„²å­˜å‹¾é¸ç‹€æ…‹åˆ° localStorage
            const checkedState = Array.from(checkboxes).map(cb => cb.checked);
            localStorage.setItem('kyushu_checklist', JSON.stringify(checkedState));
        }
        
        // é é¢è¼‰å…¥æ™‚æ¢å¾©è¡Œææª¢æŸ¥æ¸…å–®ç‹€æ…‹
        function loadChecklist() {
            const saved = localStorage.getItem('kyushu_checklist');
            if (saved) {
                const checkedState = JSON.parse(saved);
                const checkboxes = document.querySelectorAll('.check-item');
                checkboxes.forEach((cb, index) => {
                    if (checkedState[index] !== undefined) {
                        cb.checked = checkedState[index];
                    }
                });
                // æ›´æ–°é€²åº¦é¡¯ç¤º
                const total = checkboxes.length;
                const checked = document.querySelectorAll('.check-item:checked').length;
                const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
                document.getElementById('packProgress').textContent = percentage + '%';
                document.getElementById('progressBar').style.width = percentage + '%';
            }
        }

        // å‚™è¨»äº‹é …ç®¡ç†
        let notes = JSON.parse(localStorage.getItem('kyushu_notes') || '[]');
        
        function renderNotes() {
            const container = document.getElementById('notesList');
            container.innerHTML = notes.map((note, index) => `
                <div class="bg-white border border-slate-100 rounded-xl p-3 flex justify-between items-start gap-2">
                    <span class="text-sm text-slate-700 flex-1">${note}</span>
                    <button onclick="deleteNote(${index})" class="text-slate-400 hover:text-red-500 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function addNote() {
            const input = document.getElementById('noteInput');
            const text = input.value.trim();
            if (text) {
                notes.push(text);
                localStorage.setItem('kyushu_notes', JSON.stringify(notes));
                input.value = '';
                renderNotes();
            }
        }
        
        function deleteNote(index) {
            notes.splice(index, 1);
            localStorage.setItem('kyushu_notes', JSON.stringify(notes));
            renderNotes();
        }
        
        // é é¢è¼‰å…¥æ™‚æ¸²æŸ“å‚™è¨»
        renderNotes();

        // ========== è¨˜å¸³æœ¬åŠŸèƒ½ ==========
        let expenses = JSON.parse(localStorage.getItem('kyushu_expenses') || '[]');
        let currentRate = 0.22; // é è¨­åŒ¯ç‡ 1 JPY = 0.22 TWD
        
        // åŒ¯ç‡æ›ç®—åŠŸèƒ½
        function convertCurrency(from) {
            const jpyInput = document.getElementById('jpyInput');
            const twdInput = document.getElementById('twdInput');
            const rate = parseFloat(document.getElementById('exchangeRate').value) || 0.22;
            
            if (from === 'jpy') {
                const jpy = parseFloat(jpyInput.value) || 0;
                twdInput.value = (jpy * rate).toFixed(2);
            } else {
                const twd = parseFloat(twdInput.value) || 0;
                jpyInput.value = (twd / rate).toFixed(0);
            }
        }
        
        function updateExchangeRate() {
            const newRate = parseFloat(document.getElementById('exchangeRate').value) || 0.22;
            currentRate = newRate;
            // é‡æ–°æ›ç®—
            convertCurrency('jpy');
        }
        
        const categoryNames = {
            food: 'é¤é£²',
            transport: 'äº¤é€š',
            shopping: 'è³¼ç‰©',
            hotel: 'ä½å®¿',
            ticket: 'æ™¯é»',
            other: 'å…¶ä»–'
        };
        
        const categoryIcons = {
            food: 'ğŸœ',
            transport: 'ğŸšƒ',
            shopping: 'ğŸ›ï¸',
            hotel: 'ğŸ¨',
            ticket: 'ğŸ«',
            other: 'ğŸ“¦'
        };
        
        // è‡ªå‹•åˆ†é¡é—œéµå­—
        const categoryKeywords = {
            food: ['æ‹‰éºµ', 'å£½å¸', 'é¤å»³', 'é£Ÿå ‚', 'ç‡’è‚‰', 'å®šé£Ÿ', 'è•éº¥', 'çƒé¾', 'å’–å•¡', 'éºµåŒ…', 'ç”œé»', 'è¶…å¸‚', 'ä¾¿åˆ©åº—', '7-11', 'å…¨å®¶', 'lawson'],
            transport: ['JR', 'åœ°éµ', 'åœ°éµ', 'æ–°å¹¹ç·š', 'å·´å£«', 'è¨ˆç¨‹è»Š', 'taxi', 'ç§Ÿè»Š', 'åœè»Š', 'æ²¹éŒ¢'],
            shopping: ['è—¥å¦', 'ç™¾è²¨', 'outlet', 'è¶…å¸‚', 'ä¾¿åˆ©å•†åº—', 'ç´€å¿µå“', 'ä¼´æ‰‹ç¦®', 'uniqlo', 'ç„¡å°', 'å¤§åœ‹', 'æ¾æœ¬æ¸…'],
            hotel: ['hotel', 'æ—…é¤¨', 'æ°‘å®¿', 'ä½å®¿', 'æº«æ³‰'],
            ticket: ['é–€ç¥¨', 'å…¥å ´åˆ¸', 'åˆ¸', 'æ°´æ—é¤¨', 'å‹•ç‰©åœ’', 'åšè¦½æœƒ', 'æ™¯é»']
        };
        
        // æƒææ”¶æ“š - é¡¯ç¤ºé¸é …
        function showReceiptOptions() {
            // å‰µå»ºé¸é …å°è©±æ¡†
            const modal = document.createElement('div');
            modal.id = 'receiptOptionModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end justify-center';
            modal.innerHTML = `
                <div class="bg-white w-full max-w-sm rounded-t-3xl p-6 animate-slide-up">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 text-center">é¸æ“‡æ”¶æ“šä¾†æº</h3>
                    <div class="space-y-3">
                        <button onclick="selectReceiptSource('camera')" class="w-full bg-blue-500 text-white font-bold py-4 rounded-2xl flex items-center justify-center gap-3">
                            <i class="fas fa-camera text-xl"></i> é–‹å•Ÿç›¸æ©Ÿæ‹ç…§
                        </button>
                        <button onclick="selectReceiptSource('album')" class="w-full bg-slate-100 text-slate-700 font-bold py-4 rounded-2xl flex items-center justify-center gap-3">
                            <i class="fas fa-images text-xl"></i> å¾ç›¸ç°¿é¸æ“‡
                        </button>
                        <button onclick="closeReceiptOptions()" class="w-full text-slate-400 py-3 mt-2">å–æ¶ˆ</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // é—œé–‰é¸é …å°è©±æ¡†
        function closeReceiptOptions() {
            const modal = document.getElementById('receiptOptionModal');
            if (modal) modal.remove();
        }
        
        // é¸æ“‡æ”¶æ“šä¾†æº
        function selectReceiptSource(source) {
            closeReceiptOptions();
            if (source === 'camera') {
                document.getElementById('cameraInput').click();
            } else {
                document.getElementById('receiptInput').click();
            }
        }
        
        async function processReceipt(input) {
            const file = input.files[0];
            if (!file) return;
            
            const status = document.getElementById('scanningStatus');
            const progress = document.getElementById('scanProgress');
            status.classList.remove('hidden');
            
            try {
                const result = await Tesseract.recognize(
                    file,
                    'chi_sim+eng+jpn',
                    {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                progress.style.width = (m.progress * 100) + '%';
                            }
                        }
                    }
                );
                
                const text = result.data.text;
                const amount = extractAmount(text);
                const store = extractStore(text);
                const category = autoCategory(store + ' ' + text);
                
                addExpense({
                    store: store || 'æœªçŸ¥å•†å®¶',
                    amount: amount || 0,
                    category: category,
                    date: new Date().toISOString(),
                    ocr: text.substring(0, 100)
                });
                
                status.classList.add('hidden');
                progress.style.width = '0%';
                
            } catch (error) {
                alert('è¾¨è­˜å¤±æ•—ï¼Œè«‹å˜—è©¦æ‰‹å‹•æ–°å¢');
                status.classList.add('hidden');
            }
        }
        
        // æå–é‡‘é¡
        function extractAmount(text) {
            // æ‰¾ Â¥ æˆ– å†† å¾Œçš„æ•¸å­—
            const patterns = [
                /[Â¥ï¿¥]\s*(\d{1,3}(?:,\d{3})+|\d+)/,
                /(\d{1,3}(?:,\d{3})+|\d+)\s*[å††]/,
                /åˆè¨ˆ.*?[Â¥ï¿¥]\s*(\d{1,3}(?:,\d{3})+|\d+)/,
                /ç¸½è¨ˆ.*?[Â¥ï¿¥]\s*(\d{1,3}(?:,\d{3})+|\d+)/,
                /(\d{1,3}(?:,\d{3})+|\d+)\s*å††/
            ];
            
            for (let pattern of patterns) {
                const match = text.match(pattern);
                if (match) {
                    return parseInt(match[1].replace(/,/g, ''));
                }
            }
            return 0;
        }
        
        // æå–å•†å®¶åç¨±
        function extractStore(text) {
            const lines = text.split('\n').filter(l => l.trim());
            // é€šå¸¸ç¬¬ä¸€è¡Œæ˜¯åº—å
            if (lines.length > 0) {
                const store = lines[0].trim();
                if (store.length < 20) return store;
            }
            return 'æœªçŸ¥å•†å®¶';
        }
        
        // è‡ªå‹•åˆ†é¡
        function autoCategory(text) {
            text = text.toLowerCase();
            for (let [cat, keywords] of Object.entries(categoryKeywords)) {
                for (let keyword of keywords) {
                    if (text.includes(keyword)) return cat;
                }
            }
            return 'other';
        }
        
        // æ‰‹å‹•æ–°å¢æ”¯å‡º
        function addManualExpense() {
            const store = document.getElementById('manualStore').value.trim();
            const amount = parseInt(document.getElementById('manualAmount').value);
            const category = document.getElementById('manualCategory').value;
            
            if (!store || !amount) {
                alert('è«‹å¡«å¯«å•†å®¶åç¨±å’Œé‡‘é¡');
                return;
            }
            
            addExpense({
                store: store,
                amount: amount,
                category: category,
                date: new Date().toISOString()
            });
            
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('manualStore').value = '';
            document.getElementById('manualAmount').value = '';
        }
        
        // æ–°å¢æ”¯å‡º
        function addExpense(expense) {
            expenses.unshift(expense);
            localStorage.setItem('kyushu_expenses', JSON.stringify(expenses));
            updateAccounting();
        }
        
        // åˆªé™¤æ”¯å‡º
        function deleteExpense(index) {
            expenses.splice(index, 1);
            localStorage.setItem('kyushu_expenses', JSON.stringify(expenses));
            updateAccounting();
        }
        
        // æ›´æ–°è¨˜å¸³é¡¯ç¤º
        function updateAccounting() {
            // è¨ˆç®—ç¸½è¨ˆ
            const total = expenses.reduce((sum, e) => sum + e.amount, 0);
            const today = new Date().toDateString();
            const todayTotal = expenses
                .filter(e => new Date(e.date).toDateString() === today)
                .reduce((sum, e) => sum + e.amount, 0);
            
            document.getElementById('totalAmount').textContent = `Â¥ ${total.toLocaleString()}`;
            document.getElementById('totalTWD').textContent = `TWD ${Math.round(total * 0.22).toLocaleString()}`;
            document.getElementById('expenseCount').textContent = expenses.length;
            document.getElementById('avgAmount').textContent = expenses.length ? `Â¥${Math.round(total / expenses.length)}` : 'Â¥0';
            document.getElementById('todayAmount').textContent = `Â¥${todayTotal.toLocaleString()}`;
            document.getElementById('expenseCountBadge').textContent = `${expenses.length} ç­†`;
            
            // æ›´æ–°åˆ†é¡çµ±è¨ˆ
            const categoryTotals = {};
            for (let exp of expenses) {
                categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
            }
            
            for (let cat of Object.keys(categoryNames)) {
                const el = document.getElementById(`cat-${cat}`);
                if (el) {
                    el.textContent = `Â¥${(categoryTotals[cat] || 0).toLocaleString()}`;
                }
            }
            
            // æ›´æ–°æ”¯å‡ºåˆ—è¡¨
            const list = document.getElementById('expenseList');
            if (expenses.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-slate-400 py-8">
                        <i class="fas fa-receipt text-3xl mb-2"></i>
                        <p class="text-sm">å°šç„¡æ”¯å‡ºè¨˜éŒ„</p>
                    </div>
                `;
            } else {
                list.innerHTML = expenses.map((exp, idx) => `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-lg">
                                ${categoryIcons[exp.category]}
                            </div>
                            <div>
                                <p class="font-bold text-slate-800 text-sm">${exp.store}</p>
                                <p class="text-xs text-slate-500">${categoryNames[exp.category]} Â· ${new Date(exp.date).toLocaleDateString('zh-TW')}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-slate-800">Â¥${exp.amount.toLocaleString()}</p>
                            <button onclick="deleteExpense(${idx})" class="text-xs text-red-500 mt-1">åˆªé™¤</button>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // åŒ¯å‡º Excel
        function exportToExcel() {
            if (expenses.length === 0) {
                alert('å°šç„¡è³‡æ–™å¯åŒ¯å‡º');
                return;
            }
            
            const data = expenses.map(e => ({
                'æ—¥æœŸ': new Date(e.date).toLocaleDateString('zh-TW'),
                'å•†å®¶': e.store,
                'é¡åˆ¥': categoryNames[e.category],
                'é‡‘é¡(æ—¥åœ“)': e.amount,
                'é‡‘é¡(å°å¹£)': Math.round(e.amount * 0.22)
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'æ”¯å‡ºæ˜ç´°');
            
            // æ·»åŠ ç¸½è¨ˆ
            const total = expenses.reduce((sum, e) => sum + e.amount, 0);
            XLSX.utils.sheet_add_json(ws, [{
                'æ—¥æœŸ': 'ç¸½è¨ˆ',
                'å•†å®¶': '',
                'é¡åˆ¥': '',
                'é‡‘é¡(æ—¥åœ“)': total,
                'é‡‘é¡(å°å¹£)': Math.round(total * 0.22)
            }], {origin: -1});
            
            XLSX.writeFile(wb, `ä¹å·æ—…éŠè¨˜å¸³_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
        
        // åŒ¯å‡ºåˆ° Email
        function exportToEmail() {
            if (expenses.length === 0) {
                alert('å°šç„¡è³‡æ–™å¯åŒ¯å‡º');
                return;
            }
            
            let body = 'ä¹å·æ—…éŠæ”¯å‡ºæ˜ç´°\n\n';
            body += '='.repeat(40) + '\n';
            
            let categoryTotals = {};
            
            expenses.forEach(e => {
                body += `${new Date(e.date).toLocaleDateString('zh-TW')}\t${e.store}\t${categoryNames[e.category]}\tÂ¥${e.amount.toLocaleString()}\n`;
                categoryTotals[e.category] = (categoryTotals[e.category] || 0) + e.amount;
            });
            
            body += '='.repeat(40) + '\n\n';
            body += 'ã€åˆ†é¡çµ±è¨ˆã€‘\n';
            
            for (let [cat, total] of Object.entries(categoryTotals)) {
                body += `${categoryNames[cat]}: Â¥${total.toLocaleString()}\n`;
            }
            
            const grandTotal = expenses.reduce((sum, e) => sum + e.amount, 0);
            body += `\nç¸½è¨ˆ: Â¥${grandTotal.toLocaleString()} (ç´„ TWD ${Math.round(grandTotal * 0.22).toLocaleString()})\n`;
            
            const subject = encodeURIComponent('ä¹å·æ—…éŠè¨˜å¸³æ˜ç´°');
            const bodyEncoded = encodeURIComponent(body);
            
            window.location.href = `mailto:?subject=${subject}&body=${bodyEncoded}`;
        }
        
        // åˆå§‹åŒ–è¨˜å¸³è³‡æ–™
        updateAccounting();
    </script>

    <!-- æ–°å¢æ™¯é» Modal -->
    <div id="addSpotModal" class="spot-modal">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-slate-800">æ–°å¢æ™¯é»</h3>
                    <button onclick="closeAddSpotModal()" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-times text-slate-500"></i>
                    </button>
                </div>
                
                <!-- é–‹å•Ÿ Google Maps -->
                <div class="mb-6">
                    <button onclick="openGoogleMapsPicker()" class="w-full bg-blue-500 text-white font-bold py-4 rounded-2xl flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-transform">
                        <i class="fas fa-map-marked-alt text-xl"></i> é–‹å•Ÿ Google Maps
                    </button>
                    <p class="text-xs text-slate-500 mt-2 text-center">åœ¨ Google Maps æ‰¾åˆ°æ™¯é»å¾Œï¼Œå›ä¾†è¼¸å…¥æ™¯é»åç¨±å³å¯</p>
                </div>
                
                <!-- é¸æ“‡æ—¥æœŸ -->
                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2">é¸æ“‡æ—¥æœŸ</label>
                    <select id="newSpotDay" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm bg-white">
                        <option value="day1">Day 1 - 7/27 (ä¸€) ç¦å²¡å¸‚å€</option>
                        <option value="day2">Day 2 - 7/28 (äºŒ) å¤ªå®°åºœ â†’ ç”±å¸ƒé™¢</option>
                        <option value="day3">Day 3 - 7/29 (ä¸‰) é‡ç”Ÿå‹•ç‰©åœ’ â†’ åšå¤š</option>
                        <option value="day4">Day 4 - 7/30 (å››) é–€å¸æ¸¯ â†’ å°å€‰</option>
                        <option value="day5">Day 5 - 7/31 (äº”) æµ·ä¹‹ä¸­é“</option>
                        <option value="day6">Day 6 - 8/01 (å…­) è¿”ç¨‹</option>
                    </select>
                </div>
                
                <!-- æ™¯é»åç¨± -->
                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2">æ™¯é»åç¨± <span class="text-red-500">*</span></label>
                    <input id="newSpotName" type="text" placeholder="å¾ Google Maps è¤‡è£½æ™¯é»åç¨±..." class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                </div>
                
                <!-- Mapcode -->
                <div class="mb-6">
                    <label class="block text-sm font-bold text-slate-700 mb-2">Mapcodeï¼ˆå»ºè­°å¡«å¯«ï¼‰</label>
                    <input id="newSpotMapcode" type="text" placeholder="ä¾‹ï¼š13 294 821*15" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                    <div class="mt-2 bg-blue-50 rounded-xl p-3 text-xs text-slate-600">
                        <p class="font-bold mb-1">ğŸ’¡ å¦‚ä½•æŸ¥è©¢ Mapcodeï¼š</p>
                        <ol class="list-decimal list-inside space-y-1">
                            <li>é–‹å•Ÿ <a href="https://www.mapion.co.jp" target="_blank" class="text-blue-600 underline">Mapion ç¶²ç«™</a></li>
                            <li>æœå°‹æ™¯é»åç¨±ï¼ˆæ—¥æ–‡æˆ–ä¸­æ–‡ï¼‰</li>
                            <li>é»æ“Šåœ°é»å¾Œï¼Œçœ‹å·¦ä¸Šè§’çš„ã€Œãƒãƒ”ã‚³ãƒ¼ãƒ‰ã€</li>
                            <li>è¤‡è£½æ•¸å­—ï¼ˆä¾‹ï¼š13 294 821*15ï¼‰å›ä¾†è²¼ä¸Š</li>
                        </ol>
                    </div>
                </div>
                
                <!-- æŒ‰éˆ• -->
                <div class="flex gap-3">
                    <button onclick="closeAddSpotModal()" class="flex-1 bg-slate-100 text-slate-700 font-bold py-3 rounded-xl">å–æ¶ˆ</button>
                    <button onclick="saveNewSpot()" class="flex-1 bg-green-500 text-white font-bold py-3 rounded-xl">ç¢ºå®šæ–°å¢</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== è¡Œç¨‹ç·¨è¼¯åŠŸèƒ½ ==========
        // æ³¨æ„ï¼šisEditMode å·²åœ¨ä¸» script ä¸­å®šç¾©
        
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('editModeBtn');
            const addSection = document.getElementById('addSpotSection');
            const itinerary = document.getElementById('itinerary');
            
            if (isEditMode) {
                btn.textContent = 'å®Œæˆ';
                btn.classList.remove('bg-blue-100', 'text-blue-600');
                btn.classList.add('bg-green-100', 'text-green-600');
                addSection.classList.remove('hidden');
                itinerary.classList.add('edit-mode');
                // é¡¯ç¤ºåˆªé™¤æŒ‰éˆ‘ï¼Œéš±è— Google Maps æŒ‰éˆ‘
                document.querySelectorAll('.delete-btn').forEach(b => b.classList.remove('hidden'));
                document.querySelectorAll('.nav-map-btn').forEach(b => b.classList.add('hidden'));
            } else {
                btn.textContent = 'ç·¨è¼¯';
                btn.classList.remove('bg-green-100', 'text-green-600');
                btn.classList.add('bg-blue-100', 'text-blue-600');
                addSection.classList.add('hidden');
                itinerary.classList.remove('edit-mode');
                // éš±è—åˆªé™¤æŒ‰éˆ‘ï¼Œé¡¯ç¤º Google Maps æŒ‰éˆ‘
                document.querySelectorAll('.delete-btn').forEach(b => b.classList.add('hidden'));
                document.querySelectorAll('.nav-map-btn').forEach(b => b.classList.remove('hidden'));
            }
        }
        
        // æ·»åŠ åˆªé™¤æŒ‰éˆ•åˆ°æ‰€æœ‰æ™¯é»å¡ç‰‡
        function addDeleteButtons() {
            const cards = document.querySelectorAll('#itinerary .spot-card');
            cards.forEach((card, index) => {
                // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰åˆªé™¤æŒ‰éˆ•
                if (card.querySelector('.delete-btn')) {
                    card.querySelector('.delete-btn').classList.remove('hidden');
                    return;
                }
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn text-red-500 w-8 h-8 rounded-full bg-red-50 flex items-center justify-center ml-2';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.onclick = function(e) {
                    e.stopPropagation();
                    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ™¯é»å—ï¼Ÿ')) {
                        card.remove();
                        saveItinerary();
                    }
                };
                
                const chevronContainer = card.querySelector('.fa-chevron-down')?.parentElement;
                if (chevronContainer) {
                    chevronContainer.appendChild(deleteBtn);
                }
            });
        }
        
        // åˆªé™¤æ™¯é»ï¼ˆä¾›æ–°å¢æ™‚ä½¿ç”¨ï¼‰
        function deleteSpot(card) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ™¯é»å—ï¼Ÿ')) {
                card.remove();
                saveItinerary();
            }
        }
        
        // ç§»é™¤åˆªé™¤æŒ‰éˆ•
        function removeDeleteButtons() {
            const deleteBtns = document.querySelectorAll('.delete-btn');
            deleteBtns.forEach(btn => btn.remove());
        }
        
        // é–‹å•Ÿæ–°å¢æ™¯é» Modal
        function openAddSpotModal() {
            document.getElementById('addSpotModal').classList.add('active');
        }
        
        // é—œé–‰æ–°å¢æ™¯é» Modal
        function closeAddSpotModal() {
            document.getElementById('addSpotModal').classList.remove('active');
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('newSpotName').value = '';
            document.getElementById('newSpotAddress').value = '';
            document.getElementById('newSpotMapcode').value = '';
            document.getElementById('newSpotNote').value = '';
        }
        
        // åˆå§‹åŒ–æ‹–å‹•æ’åº
        function initSortable() {
            const dayContainers = document.querySelectorAll('#itineraryList > div');
            dayContainers.forEach(container => {
                new Sortable(container, {
                    group: 'shared', // å…è¨±è·¨æ—¥æœŸæ‹–å‹•
                    animation: 150,
                    handle: '.spot-card', // æ•´å€‹å¡ç‰‡éƒ½å¯ä»¥æ‹–
                    delay: 500, // é•·æŒ‰ 500ms æ‰é–‹å§‹æ‹–å‹•
                    delayOnTouchOnly: true,
                    ghostClass: 'bg-blue-50',
                    onStart: function(evt) {
                        // é–‹å§‹æ‹–å‹•æ™‚é¡¯ç¤ºæç¤º
                        if (navigator.vibrate) navigator.vibrate(50);
                    },
                    onEnd: function(evt) {
                        saveItinerary();
                        // å¦‚æœè·¨æ—¥æœŸç§»å‹•ï¼Œæ›´æ–°é¡¯ç¤º
                        if (evt.to !== evt.from) {
                            updateDayLabels();
                        }
                    }
                });
            });
        }
        
        // æ›´æ–°æ—¥æœŸæ¨™ç±¤ï¼ˆæ‹–å‹•å¾Œå¯èƒ½éœ€è¦èª¿æ•´ï¼‰
        function updateDayLabels() {
            // å¯é¸ï¼šåœ¨é€™è£¡æ·»åŠ æ›´æ–°æ—¥æœŸæ¨™ç±¤çš„é‚è¼¯
        }
        
        // é–‹å•Ÿ Google Maps é¸å–åœ°é»
        function openGoogleMapsPicker() {
            window.open('https://www.google.com/maps/search/ç¦å²¡+æ™¯é»', '_blank');
        }
        
        // è§£æ Google Maps é€£çµï¼ˆä¿ç•™ä½†ç°¡åŒ–ï¼‰
        function parseGoogleMapsUrl() {
            alert('è«‹ç›´æ¥è¤‡è£½ Google Maps çš„åç¨±å’Œåœ°å€åˆ°ä¸‹æ–¹æ¬„ä½');
        }
        
        // å„²å­˜æ–°å¢æ™¯é»
        function saveNewSpot() {
            const day = document.getElementById('newSpotDay').value;
            const name = document.getElementById('newSpotName').value.trim();
            const mapcode = document.getElementById('newSpotMapcode').value.trim();
            
            if (!name) {
                alert('è«‹è¼¸å…¥æ™¯é»åç¨±');
                return;
            }
            
            // æ‰¾åˆ°å°æ‡‰çš„ Day å€å¡Š
            const dayMap = {
                'day1': 'Day 1',
                'day2': 'Day 2', 
                'day3': 'Day 3',
                'day4': 'Day 4',
                'day5': 'Day 5',
                'day6': 'Day 6'
            };
            const dayText = dayMap[day];
            
            const dayHeaders = document.querySelectorAll('#itineraryList > div > p');
            let targetDay = null;
            
            dayHeaders.forEach(header => {
                if (header.textContent.includes(dayText)) {
                    targetDay = header.parentElement;
                }
            });
            
            if (!targetDay) {
                alert('æ‰¾ä¸åˆ°å°æ‡‰çš„æ—¥æœŸ');
                return;
            }
            
            // å»ºç«‹æ–°æ™¯é»å¡ç‰‡ï¼ˆèˆ‡é è¨­å¡ç‰‡ç›¸åŒæ ¼å¼ï¼‰
            const newCard = document.createElement('div');
            newCard.className = 'spot-card bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 overflow-hidden';
            
            // å¦‚æœæœ‰ Mapcode å°±é¡¯ç¤º
            const mapcodeHtml = mapcode ? `<div class="mapcode-display">${mapcode}</div>` : '';
            
            newCard.innerHTML = `
                <div class="p-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1 cursor-pointer" onclick="toggleSpot(this.closest('.spot-card'))">
                            <p class="font-bold text-slate-800 text-lg">${name}</p>
                            ${mapcodeHtml}
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="event.stopPropagation(); window.open('https://www.google.com/maps/search/' + encodeURIComponent('${name} ç¦å²¡'), '_blank')" class="nav-map-btn w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center">
                                <i class="fas fa-map-location-dot"></i>
                            </button>
                            <button onclick="event.stopPropagation(); deleteSpot(this.closest('.spot-card'))" class="delete-btn hidden text-red-500 w-8 h-8 rounded-full bg-red-50 flex items-center justify-center">
                                <i class="fas fa-trash"></i>
                            </button>
                            <i class="fas fa-chevron-down text-slate-400 transition-transform cursor-pointer" onclick="toggleSpot(this.closest('.spot-card'))"></i>
                        </div>
                    </div>
                </div>
                <div class="spot-detail hidden px-4 pb-4 border-t border-slate-100 pt-3">
                    <p class="text-sm text-slate-600 mb-2"><i class="fas fa-info-circle text-green-500 mr-2"></i>${name}</p>
                    <p class="text-sm text-slate-600 mb-2"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i>ç¦å²¡ç¸£</p>
                    <button onclick="window.open('https://www.google.com/maps/search/' + encodeURIComponent('${name} ç¦å²¡'), '_blank')" class="w-full bg-blue-500 text-white py-2 rounded-xl font-bold text-sm">
                        <i class="fas fa-map-location-dot mr-2"></i>é–‹å•Ÿ Google Maps
                    </button>
                </div>
            `;
            
            // æ’å…¥åˆ° Day å€å¡Š
            targetDay.appendChild(newCard);
            
            // å¦‚æœåœ¨ç·¨è¼¯æ¨¡å¼ï¼Œé¡¯ç¤ºåˆªé™¤æŒ‰éˆ•
            if (isEditMode) {
                const deleteBtn = newCard.querySelector('.delete-btn');
                if (deleteBtn) deleteBtn.classList.remove('hidden');
                const navBtn = newCard.querySelector('.nav-map-btn');
                if (navBtn) navBtn.classList.add('hidden');
            }
            
            saveItinerary();
            closeAddSpotModal();
            alert('æ™¯é»å·²æ–°å¢ï¼');
        }
        
        // å„²å­˜è¡Œç¨‹åˆ° localStorage
        function saveItinerary() {
            const itineraryHTML = document.getElementById('itineraryList').innerHTML;
            localStorage.setItem('kyushu_itinerary', itineraryHTML);
        }
        
        // é é¢è¼‰å…¥æ™‚æ¢å¾©è¡Œç¨‹
        function loadItinerary() {
            const saved = localStorage.getItem('kyushu_itinerary');
            if (saved) {
                document.getElementById('itineraryList').innerHTML = saved;
            }
        }
        
        // ä¿®å¾©æ‰€æœ‰æ™¯é»å¡ç‰‡çš„æŒ‰éˆ‘çµæ§‹
        function fixAllSpotCards() {
            const cards = document.querySelectorAll('#itineraryList .spot-card');
            cards.forEach(card => {
                // æª¢æŸ¥æ˜¯å¦å·²ä¿®å¾©ï¼ˆæœ‰ nav-map-btn æˆ– delete-btnï¼‰
                if (card.querySelector('.nav-map-btn') || card.querySelector('.delete-btn')) {
                    return; // å·²ä¿®å¾©ï¼Œè·³é
                }
                
                // å–å¾—å¡ç‰‡æ¨™é¡Œå€åŸŸ
                const header = card.querySelector('.p-4');
                if (!header) return;
                
                // å–å¾—æ™¯é»åç¨±
                const nameEl = card.querySelector('.font-bold.text-slate-800');
                const spotName = nameEl ? nameEl.textContent.trim() : '';
                
                // å–å¾—å±•é–‹å…§å®¹è£¡çš„åœ°å€
                const addressEl = card.querySelector('.spot-detail .fa-map-marker-alt');
                let address = spotName + ' ç¦å²¡';
                if (addressEl && addressEl.parentElement) {
                    const addressText = addressEl.parentElement.textContent.trim();
                    if (addressText && addressText.length > 3) address = addressText;
                }
                
                // æ‰¾åˆ°æ¨™é¡Œå€çš„ flex å®¹å™¨
                const flexContainer = header.querySelector('.flex.justify-between, .flex');
                if (!flexContainer) return;
                
                // æ‰¾åˆ°å³å´å€åŸŸæˆ–å‰µå»º
                let rightSection = flexContainer.querySelector('.flex.items-center');
                if (!rightSection) {
                    rightSection = document.createElement('div');
                    rightSection.className = 'flex items-center gap-2';
                    
                    // æ‰¾åˆ° chevron ä¸¦ç§»åˆ°æ–°å®¹å™¨
                    const chevron = flexContainer.querySelector('.fa-chevron-down');
                    if (chevron) {
                        chevron.style.cursor = 'pointer';
                        rightSection.appendChild(chevron);
                    }
                    flexContainer.appendChild(rightSection);
                }
                
                // å‰µå»º Google Maps æŒ‰éˆ‘
                const mapBtn = document.createElement('button');
                mapBtn.className = 'nav-map-btn w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center';
                mapBtn.innerHTML = '<i class="fas fa-map-location-dot"></i>';
                mapBtn.onclick = function(e) {
                    e.stopPropagation();
                    window.open('https://www.google.com/maps/search/' + encodeURIComponent(address), '_blank');
                };
                
                // å‰µå»ºåˆªé™¤æŒ‰éˆ‘
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn hidden text-red-500 w-8 h-8 rounded-full bg-red-50 flex items-center justify-center';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.onclick = function(e) {
                    e.stopPropagation();
                    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ™¯é»å—ï¼Ÿ')) {
                        card.remove();
                        saveItinerary();
                    }
                };
                
                // æ’å…¥åˆ° rightSection çš„é–‹é ­
                rightSection.insertBefore(mapBtn, rightSection.firstChild);
                rightSection.insertBefore(deleteBtn, rightSection.firstChild);
            });
            
            // æ ¹æ“šç•¶å‰æ¨¡å¼é¡¯ç¤ºæ­£ç¢ºçš„æŒ‰éˆ‘
            const itinerary = document.getElementById('itinerary');
            if (itinerary.classList.contains('edit-mode')) {
                document.querySelectorAll('.delete-btn').forEach(b => b.classList.remove('hidden'));
                document.querySelectorAll('.nav-map-btn').forEach(b => b.classList.add('hidden'));
            } else {
                document.querySelectorAll('.delete-btn').forEach(b => b.classList.add('hidden'));
                document.querySelectorAll('.nav-map-btn').forEach(b => b.classList.remove('hidden'));
            }
        }
        
        // é é¢åˆ‡æ›åˆ°è¡Œç¨‹æ™‚ä¿®å¾©
        const originalShowPage = showPage;
        showPage = function(pageId, btn) {
            originalShowPage(pageId, btn);
            if (pageId === 'itinerary') {
                fixAllSpotCards();
            }
        };
        
        // åˆå§‹åŒ–è¡Œç¨‹
        loadItinerary();
        
        // ç«‹å³ä¿®å¾©æ‰€æœ‰å¡ç‰‡ï¼ˆé é¢è¼‰å…¥æ™‚ï¼‰
        fixAllSpotCards();
        
        // é¦–é å¾ŒçºŒè¡Œç¨‹æ•¸æ“š
        const dailySchedule = {
            1: [
                { time: '11:00', title: 'å¤©ç¥å•†åœˆ', desc: 'è³¼ç‰©ã€ç¾é£Ÿã€åœ°ä¸‹è¡—' },
                { time: '12:30', title: 'ä¸€è˜­æ‹‰éºµ ç¸½æœ¬åº—', desc: 'ğŸœ å¿…åƒï¼' },
                { time: '18:00', title: 'åšå¤šè¯å‘³é³¥', desc: 'ğŸ² ä¹å·æ°´ç‚Šé‹ååº—' },
                { time: '20:00', title: 'Check-in ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—', desc: 'ğŸ¨ ç¦å²¡å¸‚å€ä½å®¿', type: 'hotel' }
            ],
            2: [
                { time: '09:00', title: 'å¤ªå®°åºœå¤©æ»¿å®®', desc: 'â›©ï¸ å­¸å•ä¹‹ç¥ã€è¡¨åƒé“é€›è¡—' },
                { time: '14:00', title: 'å‰å¾€ç”±å¸ƒé™¢', desc: 'ğŸšƒ æ­ä¹˜ç”±å¸ƒé™¢ä¹‹æ£®' },
                { time: '16:00', title: 'ç”±å¸ƒé™¢æ•£ç­–', desc: 'ğŸš¶ é‡‘éºŸæ¹–ã€æ¹¯ä¹‹åªè¡—é“' },
                { time: '18:00', title: 'Check-in Yufuin Rakuyu', desc: 'ğŸ¨ æº«æ³‰æ—…é¤¨ä¸€æ³ŠäºŒé£Ÿ', type: 'hotel' }
            ],
            3: [
                { time: '09:00', title: 'ä¹å·éæ´²é‡ç”Ÿå‹•ç‰©åœ’', desc: 'ğŸ¦ è‡ªé§•éŠåœ’ã€é¤µé£Ÿç…å­' },
                { time: '13:00', title: 'æ—¥ç”°å¸‚', desc: 'ğŸ˜ï¸ è±†ç”°ç”ºè€è¡—æ•£ç­–' },
                { time: '17:00', title: 'åšå¤šé‹æ²³åŸ', desc: 'ğŸ›ï¸ è³¼ç‰©ã€æ™šé¤ã€é‹¼å½ˆç§€' },
                { time: '20:00', title: 'è¿”å›ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—', desc: 'ğŸ¨ ç¦å²¡å¸‚å€ä½å®¿', type: 'hotel' }
            ],
            4: [
                { time: '09:00', title: 'é–€å¸æ¸¯å¾©å¤å€', desc: 'ğŸ›ï¸ è—ç¿¼æ©‹ã€æ‡·èˆŠå»ºç¯‰' },
                { time: '13:00', title: 'ä¹å·éµé“æ­·å²é¤¨', desc: 'ğŸš‚ è’¸æ°£ç«è»Šã€æ¨¡æ“¬é§•é§›' },
                { time: '16:00', title: 'The Outlets Kitakyushu', desc: 'ğŸ›ï¸ å“ç‰ŒæŠ˜æ‰£åº—è³¼ç‰©' },
                { time: '20:00', title: 'è¿”å›ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—', desc: 'ğŸ¨ ç¦å²¡å¸‚å€ä½å®¿', type: 'hotel' }
            ],
            5: [
                { time: '09:00', title: 'æµ·ä¹‹ä¸­é“æµ·æ¿±å…¬åœ’', desc: 'ğŸ–ï¸ æ²™æ¿‰ã€èŠ±æµ·ã€å–®è»ŠéŠåœ’' },
                { time: '13:00', title: 'æµ·æ´‹ä¸–ç•Œæµ·ä¹‹ä¸­é“', desc: 'ğŸ¬ æµ·è±šç§€ã€æ°´æ—é¤¨' },
                { time: '17:00', title: 'å¤©ç¥å•†åœˆæœ€å¾Œæ¡è³¼', desc: 'ğŸ›ï¸ è—¥å¦ã€ä¼´æ‰‹ç¦®' },
                { time: '20:00', title: 'è¿”å›ç´¢æ‹‰åˆ©äºè¥¿éµé…’åº—', desc: 'ğŸ¨ ç¦å²¡å¸‚å€ä½å®¿', type: 'hotel' }
            ],
            6: [
                { time: '10:00', title: 'æœ€å¾Œæ¡è³¼', desc: 'ğŸ›ï¸ å¤©ç¥åœ°ä¸‹è¡—ã€è£œè²¨' },
                { time: '14:00', title: 'å‰å¾€ç¦å²¡æ©Ÿå ´', desc: 'âœˆï¸ å»ºè­°æå‰2å°æ™‚' },
                { time: '16:00', title: 'æ­æ©Ÿè¿”ç¨‹', desc: 'ğŸ‘‹ å†è¦‹ä¹å·ï¼' }
            ]
        };

        // æ›´æ–°é¦–é å¾ŒçºŒè¡Œç¨‹ï¼ˆé è¨­é¡¯ç¤ºç¬¬ä¸€å¤©è¡Œç¨‹ï¼‰
        function updateUpcomingSchedule() {
            const schedule = dailySchedule[1]; // é è¨­é¡¯ç¤º Day 1 è¡Œç¨‹
            
            let scheduleHTML = '<div class="absolute left-7 top-6 bottom-6 w-0.5 bg-blue-200"></div>';
            
            schedule.forEach((item, index) => {
                const isHotel = item.type === 'hotel';
                const dotColor = isHotel ? 'bg-green-500' : 'bg-blue-500';
                
                scheduleHTML += `
                    <div class="flex items-start gap-4 relative z-10">
                        <div class="w-3 h-3 ${dotColor} rounded-full mt-1.5 ring-4 ring-white"></div>
                        <div>
                            <p class="text-sm font-bold text-slate-800">${item.time} ${item.title}</p>
                            <p class="text-xs text-slate-500">${item.desc}</p>
                        </div>
                    </div>
                `;
            });
            
            const container = document.getElementById('upcomingSchedule');
            if (container) {
                container.innerHTML = scheduleHTML;
            }
        }

        // é é¢è¼‰å…¥æ™‚æ›´æ–°å¾ŒçºŒè¡Œç¨‹
        updateUpcomingSchedule();
        
        // é é¢è¼‰å…¥å¾Œåˆå§‹åŒ–æ‹–å‹•
        setTimeout(initSortable, 100);
    </script>
</body>
</html>